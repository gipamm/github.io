var express = require("express");
var respond = require("../");

var app = express();

app.get("/simple(.:format)?", respond()
  .json(function(req, res) { res.json({"test": "ok"}); })
  .xml(function(req, res) { res.send("<test>ok</test>"); })
  .text(function(req, res) { res.send("test was ok"); })
  .respond
);

app.get("/custom(.:format)?", respond()
  .json(function(req, res) { res.json({test: "ok"}); })
  .to("application/test", function(req, res) { res.set("Content-Type", "text/plain"); res.send("ok"); })
  .defaultTo("application/test")
  .respond
);

app.get("/before(.:format)?", respond()
  .before(function(req, res) { req.before_status = "lirum larum"; req.continue(); })
  .json(function(req, res) { res.json({before_status: req.before_status}); })
  .text(function(req, res) { res.send("" + req.before_status); })
  .defaultTo(function(req, res) { res.set("Content-Type", "text/plain"); res.send("default handler"); })
  .respond
);

app.get("/after(.:format)?", respond()
  .json(function(req, res) { req.content_status = "json"; req.continue(); })
  .text(function(req, res) { req.content_status = "text"; req.continue(); })
  .after(function(req, res) { res.set("Content-Type", "text/plain"); res.send(req.content_status); })
  .respond
);

app.get("/full(.:format)?", respond()
  .before(function(req, res) { req.full_status = "before"; req.continue(); })
  .json(function(req, res) { req.full_status += ":json"; req.continue(); })
  .text(function(req, res) { req.full_status += ":text"; req.continue(); })
  .after(function(req, res) { res.set("Content-Type", "text/plain"); res.send(req.full_status); })
  .respond
);

module.exports = app;

